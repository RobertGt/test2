<!DOCTYPE html>
<html>


<!-- Mirrored from www.zi-han.net/theme/hplus/form_validate.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:19:15 GMT -->

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <title>后台 - 发布文章</title>
  <meta name="keywords" content="后台">
  <meta name="description" content="后台">

  <link rel="shortcut icon" href="../../favicon.ico">
  <link href="../../static/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
  <link href="../../static/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
  <link href="../../static/css/style.min862f.css?v=4.1.0" rel="stylesheet">
  <link href="../../static/css/plugins/toastr/toastr.min.css" rel="stylesheet">

</head>
<style>
  .fixed-table-container {
    border-bottom: none;
    padding-bottom: 0px;

  }

  .attachments {
    width: 243px;
    height: 161px;
    cursor: pointer;
  }

  .col-sm-2 .subnet {
    width: 95%;
    height: 100%;
    position: absolute;
    background: rgba(0, 0, 0, 0.7);
    text-align: center;
    display: none;
  }

  @media (min-width: 768px) {
    .col-sm-2 .subnet {
      width: 89%;
    }
  }

  .col-sm-2 .subnet button {
    margin-top: 27%;
    display: none;
  }

  .progress {
    height: 20px;
    overflow: hidden;
    background-color: #ECECEC;
    -webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, .1);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, .1);
    position: relative;
    width: 70%;
    margin-left: 15%;
    padding: 1px;
    margin-top: 27%;
    display: none;
  }

  .bar {
    background-color: green;
    display: block;
    width: 0%;
    height: 20px;
  }

  .percent {
    position: absolute;
    height: 20px;
    display: inline-block;
    top: 3px;
    left: 2%;
    color: #FFFFFF;
  }

  .imglist {
    float: left;
  }

  .imglist .tupian {
    width: 77px;
    height: 77px;
    margin: 0px 5px;
  }

  .imglist .dels {
    position: absolute;
    width: 20px;
    margin-left: 67px;
    margin-top: -8px;
    cursor: pointer;
  }
  .help-block{
    margin-top: 0px;
  }
</style>

<body class="gray-bg">
  <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
      <div class="col-sm-12">
        <div class="ibox float-e-margins">
          <div class="ibox-title">
            <h5>发布文章</h5>
            <div class="ibox-tools">
              <a class="refresh-link" href="javascript:location.reload()">
                <i class="fa fa-refresh"></i>
              </a>
              <a class="collapse-link">
                <i class="fa fa-chevron-up"></i>
              </a>
            </div>
          </div>
          <div class="ibox-content">
            <form class="form-horizontal m-t" id="signupForm" action="">
              <input type="hidden" name="state" value="0"/>
              <div class="form-group">
                <label class="col-sm-2 control-label">预览图：</label>
                <div class="col-sm-2">
                  <a class="fancybox" href="../../static/img/800400.png" title="预览图"><img src="../../static/img/800400.png" class="attachments " id="thumb"/></a>
                </div>
              </div>
              <input name="thumb" type="hidden" class="form-control"/>
              <div class="form-group">
                <div class="col-sm-9 col-sm-offset-2">
                  <button class="btn btn-white btn-whites" type="button">
                    <i class="fa fa-upload"></i>
                    上传预览图
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">文章标题：</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" placeholder="请输入文章标题" name="title"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">作者名称：</label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" placeholder="请输入作者名称" name="author"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">文章摘要：</label>
                <div class="col-sm-9">
                  <textarea name="describe" class="form-control" style="height:130px;resize: none;padding-bottom: 30px;" placeholder="请输入文章摘要" onkeyup="wordStatic(this);" onkeydown="wordStatic(this);"></textarea>

                  <div class="weui_textarea_counter text-right" style="margin-top: -30px;margin-right: 8px;height: 30px;line-height: 30px;"><span id="num">0</span>/120</div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">文章详情：</label>
                <div class="col-sm-9">
                  <script id="container" name="content" type="text/plain" style="height:500px;">

                  </script>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-8 col-sm-offset-2">
                  <button class="btn btn-primary">
                    <i class="fa fa-check"></i>
                    <span class="bold">保存并发布</span>
                  </button>
                  <button class="btn btn-info">
                    <i class="fa fa-save"></i>
                    <span class="bold">保存</span>
                  </button>
                  <button class="btn btn-link btn-outline">
                    <i class="fa fa-mail-reply"></i>
                    <span class="bold">返回</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <input id="fileuploads" type="file" name="thumbFile" style="display:none">
</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="../../static/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.13.0/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.13.0/localization/messages_zh.min.js"></script>
<script src="../../static/layer/layer.js"></script>
<script src="../../static/layer/extend/layer.ext.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
<script src="../../static/js/jquery.form.js?v=3.1.5"></script>
<script src="../../static/js/demo/form-validate-demo.min.js"></script>
<script src="../../static/js/plugins/toastr/toastr.min.js"></script>
<script src="../../static/js/toastr.options.js"></script>
<script src="../../static/js/mapgoo.js"></script>
<script type="text/javascript" charset="utf-8" src="../../static/js/plugins/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="../../static/js/plugins/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" charset="utf-8" src="../../static/js/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>
<script>
    var url = "admin/articleInsert";
    $(document).on("click",".btn-whites",function(){
        $("#fileuploads").click();
    })
    $(document).on("click",".btn-primary",function(){
        $("input[name='state']").val(1);
    })
    $(document).on("click",".btn-info",function(){
        $("input[name='state']").val(0);
    })
    $(document).ready(function(){$(".fancybox").fancybox({openEffect:"none",closeEffect:"none"})});
    $("#fileuploads").wrap("<form id='myuploads' action='"+WEBHTTP+'admin/uploadFile'+"' method='post' enctype='multipart/form-data'></form>");
    $("#fileuploads").change(function(){ //选择文件
		if($(this)[0].files[0].size > 2097152){
			toastr.error("文件大小不得超出2M");
			return false;
		}
		var ext = "jpg|png";
		var extName = $(this).eq(0).val().substring($(this).eq(0).val().lastIndexOf(".")+1).toLowerCase();
		if(ext.indexOf(extName)==-1){
			errMsg = "该文件类型不允许上传。请上传 "+ext+" 类型的文件，当前文件类型为"+extName;
			toastr.error(errMsg);
			return false;
		}
        $("#myuploads").ajaxSubmit({
            dataType:  'json', //数据格式为json
            beforeSend: function() { //开始上传
                layer.msg('<div id="percentage">上传中..</div>', {time:0,icon: 16,shade: [0.5,'#000']});
            },
            uploadProgress: function(event, position, total, percentComplete) {
                $("#percentage").html("正在上传 "+percentComplete.toFixed(2) + "%...");
            },
            success: function(resp) {
                $("#percentage").html("上传成功 ! ");
                if(resp.error == 0){
                    $("#thumb").attr("src",resp.result.viewUrl);
                    $(".fancybox").attr("href",resp.result.viewUrl);
                    $("input[name='thumb']").val(resp.result.savePath);
                    $("#thumb").load(function(){
                        layer.closeAll();
                    });
                }else{
                    layer.closeAll();
                    toastr.error(resp.reason);
                }
            },
            error:function(xhr){
                layer.closeAll();
                toastr.error("上传失败");
            }
        });
    });
    function wordStatic(input) {
        // 获取要显示已经输入字数文本框对象
        var content = document.getElementById('num');
        if (content && input) {
            // 获取输入框输入内容长度并更新到界面
            var value = input.value;
            // 将换行符不计算为单词数
            value = value.replace(/\n|\r/gi,"");
            if(value.length > 120){
                input.value = value.substring(0, 120);
                content .innerText = 120;
                return false;
            }
            // 更新计数
            content .innerText = value.length;
        }
    }
    var ue = UE.getEditor('container');
</script>
<script src="../../static/js/insert.js"></script>
